<!DOCTYPE html>

<html>
	<head>
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<link rel="stylesheet"
      href="https://unpkg.com/@chrisoakman/chessboard2@0.5.0/dist/chessboard2.min.css"
      integrity="sha384-47VeTDpmy4yT21gKPXQcLQYQZwlmz27gEH5NTrOmTk3G/SGvMyltclOW/Q8uE+sL"
      crossorigin="anonymous">
			<script src="https://unpkg.com/@chrisoakman/chessboard2@0.5.0/dist/chessboard2.min.js"
        integrity="sha384-/KwQCjA1GWovZNV3QDVtvSMDzO4reGgarF/RqHipr7hIUElH3r5zNl9WEPPOBRIF"
        crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/chess.js/0.10.3/chess.min.js" integrity="sha512-xRllwz2gdZciIB+AkEbeq+gVhX8VB8XsfqeFbUh+SzHlN96dEduwtTuVuc2u9EROlmW9+yhRlxjif66ORpsgVA==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
	</head>
	<body>
		<div id="board2" style="width: 750px; margin: 0 auto;"></div>

		<script>
		const game = new Chess();

		const board = Chessboard2('board2', {
			draggable: true,
			position: "start",
			showNotation: true,
			onDrop: function(source, target, piece) {
				// Try to make the move using chess.js
				const move = game.move({ from: source, to: target, promotion: 'q' });
				console.log(move);
				if (move === null) {
					// Illegal move, snapback
					console.log('Illegal move: ' + source + ' to ' + target);
					return 'snapback';
				} else {
					// Legal move, update board
					board.position(game.fen());
					updateStatus();
					// No return needed for legal moves
				}
			}
		});

		function updateStatus() {
			let status = '';
			if (game.in_checkmate()) {
				status = 'Game over, ' + (game.turn() === 'w' ? 'Black' : 'White') + ' wins by checkmate!';
			} else if (game.in_draw()) {
				status = 'Game over, drawn position.';
			} else {
				status = (game.turn() === 'w' ? 'White' : 'Black') + ' to move';
				if (game.in_check()) {
					status += ', ' + (game.turn() === 'w' ? 'White' : 'Black') + ' is in check!';
				}
			}
			document.getElementById('status').textContent = status;
		}

		// Add a status display below the board
		document.addEventListener('DOMContentLoaded', function() {
			const statusDiv = document.createElement('div');
			statusDiv.id = 'status';
			statusDiv.style.textAlign = 'center';
			statusDiv.style.marginTop = '20px';
			document.body.appendChild(statusDiv);
			updateStatus();
		});
		</script>
	</body>
</html>
